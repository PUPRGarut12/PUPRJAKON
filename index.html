<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Peta Interaktif Usaha</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    html, body, #map {
      height: 100%;
      margin: 0;
    }
    #sidebar {
      position: absolute;
      top: 10px;
      left: 10px;
      background: white;
      padding: 10px;
      border-radius: 5px;
      z-index: 1000;
      width: 300px;
      max-height: 90%;
      overflow-y: auto;
      box-shadow: 0 0 5px rgba(0,0,0,0.3);
    }
    #toggleSidebar {
      position: absolute;
      top: 10px;
      left: 320px;
      z-index: 1001;
      background: #fff;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<div id="sidebar">
  <h3>Daftar Usaha</h3>
  <ul id="data-list"></ul>
</div>
<button id="toggleSidebar">Tutup</button>
<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.locatecontrol/dist/L.Control.Locate.min.js" charset="utf-8"></script>
<script>
  // Inisialisasi Peta
  const map = L.map('map').setView([-7.2, 107.9], 10);

  // Layer Basemap
  const osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: 'Â© OpenStreetMap'
  }).addTo(map);

  const satellite = L.tileLayer('https://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
    subdomains:['mt0','mt1','mt2','mt3'],
    attribution: 'Google Satellite'
  });

  const terrain = L.tileLayer('https://{s}.google.com/vt/lyrs=p&x={x}&y={y}&z={z}', {
    subdomains:['mt0','mt1','mt2','mt3'],
    attribution: 'Google Terrain'
  });

  const baseMaps = {
    "OpenStreetMap": osm,
    "Satelit": satellite,
    "Medan": terrain
  };

  L.control.layers(baseMaps).addTo(map);

  // Lokasi Terkini
  L.control.locate({
    position: 'topleft',
    strings: {
      title: "Tampilkan lokasi saya"
    }
  }).addTo(map);

  // Sidebar Toggle
  const sidebar = document.getElementById("sidebar");
  const toggleBtn = document.getElementById("toggleSidebar");
  toggleBtn.onclick = function () {
    if (sidebar.style.display === "none") {
      sidebar.style.display = "block";
      toggleBtn.innerText = "Tutup";
    } else {
      sidebar.style.display = "none";
      toggleBtn.innerText = "Buka";
    }
  };

  // Load CSV data
  fetch("data.csv")
    .then(response => response.text())
    .then(csv => {
      const lines = csv.split("\n").slice(1); // Skip header
      const list = document.getElementById("data-list");

      lines.forEach((line, index) => {
        const cols = line.split(",");

        if (cols.length < 11) return; // skip jika tidak lengkap

        const nama = cols[1];
        const jenis = cols[2];
        const unggulan = cols[3];
        const alamat = cols[4];
        const pemilik = cols[5];
        const telp = cols[6];
        const promosi = cols[7];
        const lon = parseFloat(cols[8]);
        const lat = parseFloat(cols[9]);
        const wilayah = cols[10];

        if (isNaN(lat) || isNaN(lon)) return;

        const marker = L.marker([lat, lon]).addTo(map).bindPopup(`
          <b>${nama}</b><br/>
          Jenis: ${jenis}<br/>
          Barang Unggulan: ${unggulan}<br/>
          Alamat: ${alamat}<br/>
          Pemilik: ${pemilik}<br/>
          No. TLP: ${telp}<br/>
          Media Promosi: ${promosi}<br/>
          Jenis Wilayah Bangunan: ${wilayah}<br/>
          <a href="https://www.google.com/maps/dir/?api=1&destination=${lat},${lon}" target="_blank">Rute ke Lokasi</a>
        `);

        // Tambahkan ke sidebar
        const li = document.createElement("li");
        li.innerHTML = `<a href="#" onclick="zoomTo(${lat}, ${lon})">${nama}</a>`;
        list.appendChild(li);
      });
    });

  // Fungsi zoom dari sidebar
  function zoomTo(lat, lon) {
    map.setView([lat, lon], 17);
  }
</script>

</body>
</html>
